<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Temperature and Humidity Dashboard</title>
    <script src="https://code.highcharts.com/highcharts.js"></script>
  </head>
  <body>
    <div id="container"></div>
    <script>
      // define the chart options
      var options = {
        chart: {
          type: "spline",
          zoomType: "x",
        },
        title: {
          text: "Temperature and Humidity",
        },
        xAxis: {
          type: "datetime",
        },
        yAxis: [
          {
            title: {
              text: "Temperature (°C)",
            },
            labels: {
              format: "{value}°C",
            },
          },
          {
            title: {
              text: "Humidity (%)",
            },
            labels: {
              format: "{value}%",
            },
            opposite: true,
          },
        ],
        series: [
          {
            name: "Temperature",
            data: [],
            yAxis: 0,
            tooltip: {
              valueSuffix: "°C",
            },
          },
          {
            name: "Humidity",
            data: [],
            yAxis: 1,
            tooltip: {
              valueSuffix: "%",
            },
          },
        ],
      };

      // create the chart
      var chart = Highcharts.chart("container", options);

      // fetch data using AJAX requests
      function fetchData() {
        $.getJSON("/api/data", function (data) {
          // format the data for the chart
          var temperatureData = [];
          var humidityData = [];
          data.forEach(function (record) {
            temperatureData.push([record.timestamp, record.temperature]);
            humidityData.push([record.timestamp, record.humidity]);
          });

          // update the chart with the new data
          chart.series[0].setData(temperatureData);
          chart.series[1].setData(humidityData);
        });
      }

      // fetch data every 5 seconds
      setInterval(fetchData, 5000);
    </script>
  </body>
</html>
